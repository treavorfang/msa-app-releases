erDiagram
    CUSTOMER ||--o{ TICKET : "opens"
    CUSTOMER ||--o{ DEVICE : "owns"
    CUSTOMER {
        int id PK
        string name
        string phone
        string email
        text address
        text notes
        int created_by FK
        int updated_by FK
        datetime created_at
        datetime updated_at
    }

    USER ||--o{ CUSTOMER : "created_by"
    USER ||--o{ TICKET : "created_by"
    USER ||--o{ AUDIT_LOG : "triggers"
    USER {
        int id PK
        string username
        string email
        string password_hash
        bool is_active
        datetime created_at
    }

    TICKET ||--o{ DEVICE : "repairs"
    TICKET ||--|| INVOICE : "generates"
    TICKET ||--o{ STATUS_HISTORY : "has"
    TICKET ||--o{ REPAIR_PART : "uses"
    TICKET {
        int id PK
        string status
        string priority
        decimal estimated_cost
        decimal actual_cost
        text customer_notes
        int customer_id FK
        int created_by FK
        int technician_id FK
        datetime created_at
    }

    DEVICE ||--o{ REPAIR_PART : "consumes"
    DEVICE ||--|| WARRANTY : "has"
    DEVICE {
        int id PK
        string brand
        string model
        string serial_number
        string imei
        string status
        int customer_id FK
    }

    PART ||--o{ REPAIR_PART : "used_in"
    PART ||--o{ INVENTORY_TRANSACTION : "tracked_in"
    PART ||--o{ INVOICE_ITEM : "billed_as"
    PART {
        int id PK
        string sku
        string brand
        string category
        string name
        int stock
        decimal cost
    }

    TECHNICIAN ||--o{ TICKET : "assigned_to"
    TECHNICIAN ||--o{ REPAIR_PART : "installs"
    TECHNICIAN ||--o{ WORK_LOG : "logs_time"
    TECHNICIAN {
        int id PK
        string name
        string phone
        string pin_code
        decimal hourly_rate
        string specialization
        bool is_active
    }

    INVOICE ||--o{ INVOICE_ITEM : "contains"
    INVOICE ||--o{ PAYMENT : "receives"
    INVOICE {
        int id PK
        string invoice_number
        date issue_date
        date due_date
        decimal subtotal
        decimal tax_amount
        decimal total_amount
        string status
        int ticket_id FK
        int created_by FK
    }

    SERVICE_TYPE ||--o{ TICKET : "performed_on"
    SERVICE_TYPE {
        int id PK
        string name
        string description
        decimal base_cost
        int estimated_minutes
    }

    PAYMENT {
        int id PK
        decimal amount
        string method
        string transaction_ref
        int invoice_id FK
        datetime paid_at
    }

    WARRANTY {
        int id PK
        string type
        date start_date
        date end_date
        text terms
        int device_id FK
    }

    AUDIT_LOG {
        int id PK
        string action
        text details
        int user_id FK
        datetime created_at
    }

    ROLE ||--o{ USER : "assigned_to"
    ROLE ||--o{ PERMISSION : "has"
    ROLE {
        int id PK
        string name
        string description
    }

    INVENTORY_TRANSACTION {
        int id PK
        int part_id FK
        int quantity
        string transaction_type
        datetime created_at
    }

    WORK_LOG {
        int id PK
        int technician_id FK
        int ticket_id FK
        datetime start_time
        datetime end_time
        decimal labor_cost
    }

    STATUS_HISTORY {
        int id PK
        int ticket_id FK
        string old_status
        string new_status
        datetime changed_at
    }